# EmiyaOJ 在线判题系统 需求分析文档

## 文档信息

| 项目名称 | EmiyaOJ 在线判题系统 |
|----------|---------------------|
| 文档版本 | V1.0 |
| 创建日期 | 2026年1月6日 |
| 文档类型 | 需求分析文档 |

---

## 1. 项目概述

### 1.1 项目背景

随着编程教育的普及和在线学习需求的增长，一个功能完善、性能稳定的在线判题系统（Online Judge，简称OJ）对于编程学习和教学具有重要意义。EmiyaOJ是一个基于Spring Boot的在线判题系统，旨在提供代码提交、自动判题、用户管理、博客交流等一站式编程学习平台。

### 1.2 项目目标

1. **代码评测**：提供安全、准确、高效的代码自动判题功能
2. **题库管理**：支持题目的创建、编辑、分类和难度管理
3. **用户系统**：完善的用户注册、认证、权限管理体系
4. **社区交流**：提供博客功能，支持用户分享学习心得和技术文章
5. **可扩展性**：系统架构具备良好的可扩展性，便于后续功能迭代

### 1.3 技术选型

#### 后端技术栈
| 技术 | 版本 | 说明 |
|------|------|------|
| Spring Boot | 3.5.5 | 后端核心框架 |
| Java | 21 | 开发语言 |
| MySQL | 8.0 | 关系型数据库 |
| MyBatis-Plus | 3.5.13 | ORM框架 |
| Redis | - | 缓存中间件 |
| go-judge | - | 代码判题引擎 |
| Knife4j | - | API文档生成 |
| Spring Security | - | 安全框架 |

#### 前端技术栈
| 技术 | 版本 | 说明 |
|------|------|------|
| Vue | 3.5 | 前端框架 |
| Vite | 5.x | 构建工具 |
| TypeScript | 5.x | 开发语言 |
| Element Plus | - | UI组件库 |
| Pinia | - | 状态管理 |
| Monaco Editor | - | 代码编辑器 |

---

## 2. 功能需求分析

### 2.1 用户管理模块

#### 2.1.1 用户信息管理

**数据实体（user表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 用户ID | 主键，自增 |
| username | varchar(50) | 用户名 | 唯一，非空 |
| password | varchar(100) | 密码 | 非空，加密存储 |
| nickname | varchar(50) | 昵称 | 可选 |
| email | varchar(100) | 邮箱 | 唯一 |
| phone | varchar(20) | 手机号 | 可选 |
| avatar | varchar(255) | 头像URL | 可选 |
| status | tinyint | 状态 | 0-禁用，1-启用 |
| deleted | tinyint | 删除标记 | 0-未删除，1-已删除 |
| create_time | datetime | 创建时间 | 自动生成 |
| update_time | datetime | 更新时间 | 自动更新 |

**功能需求**

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|----------|----------|----------|--------|
| UM-001 | 用户注册 | 新用户通过用户名、密码、邮箱完成注册 | P0 |
| UM-002 | 用户登录 | 用户通过用户名和密码登录系统 | P0 |
| UM-003 | 用户登出 | 用户退出登录，清除会话 | P0 |
| UM-004 | 用户信息查询 | 查询用户详细信息 | P1 |
| UM-005 | 用户信息修改 | 修改用户昵称、头像等信息 | P1 |
| UM-006 | 密码重置 | 管理员重置用户密码 | P1 |
| UM-007 | 用户状态管理 | 启用/禁用用户账号 | P1 |
| UM-008 | 用户分页查询 | 分页查询用户列表 | P1 |
| UM-009 | 用户批量删除 | 批量逻辑删除用户 | P2 |

#### 2.1.2 角色管理

**数据实体（role表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 角色ID | 主键，自增 |
| role_code | varchar(50) | 角色编码 | 唯一，非空 |
| role_name | varchar(50) | 角色名称 | 非空 |
| description | varchar(255) | 角色描述 | 可选 |
| status | tinyint | 状态 | 0-禁用，1-启用 |
| deleted | tinyint | 删除标记 | 软删除 |

**功能需求**

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|----------|----------|----------|--------|
| RM-001 | 角色创建 | 创建新角色，指定角色编码和名称 | P1 |
| RM-002 | 角色修改 | 修改角色信息 | P1 |
| RM-003 | 角色删除 | 删除角色 | P1 |
| RM-004 | 角色列表查询 | 分页查询角色列表 | P1 |
| RM-005 | 角色权限配置 | 为角色分配权限 | P1 |
| RM-006 | 角色状态管理 | 启用/禁用角色 | P2 |

#### 2.1.3 权限管理

**数据实体（permission表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 权限ID | 主键，自增 |
| parent_id | bigint | 父权限ID | 默认0，顶级权限 |
| permission_code | varchar(255) | 权限编码 | 唯一，非空 |
| permission_name | varchar(50) | 权限名称 | 非空 |
| permission_type | tinyint | 权限类型 | 1-菜单，2-按钮，3-接口 |
| path | varchar(255) | 路由路径 | 可选 |
| component | varchar(255) | 组件路径 | 可选 |
| icon | varchar(50) | 图标 | 可选 |
| sort_order | int | 排序 | 默认0 |
| status | tinyint | 状态 | 0-禁用，1-启用 |

**功能需求**

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|----------|----------|----------|--------|
| PM-001 | 权限创建 | 创建新权限节点 | P1 |
| PM-002 | 权限修改 | 修改权限信息 | P1 |
| PM-003 | 权限删除 | 删除权限节点 | P1 |
| PM-004 | 权限树查询 | 获取权限树形结构 | P1 |
| PM-005 | 用户权限查询 | 查询用户拥有的权限列表 | P0 |
| PM-006 | 菜单权限查询 | 获取用户的菜单权限 | P1 |
| PM-007 | 按钮权限查询 | 获取用户的按钮权限 | P1 |

#### 2.1.4 用户-角色-权限关联

**关联表设计**

- **user_role表**：用户角色关联（多对多）
- **role_permission表**：角色权限关联（多对多）

**RBAC模型**

```
用户(User) --N:M--> 角色(Role) --N:M--> 权限(Permission)
```

---

### 2.2 在线判题模块

#### 2.2.1 编程语言管理

**数据实体（language表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 语言ID | 主键，自增 |
| name | varchar(50) | 语言名称 | 非空 |
| version | varchar(50) | 版本 | 非空 |
| compile_command | text | 编译命令模板 | 可选 |
| execute_command | text | 执行命令模板 | 非空 |
| source_file_ext | varchar(20) | 源文件扩展名 | 非空 |
| executable_ext | varchar(20) | 可执行文件扩展名 | 可选 |
| is_compiled | tinyint | 是否需要编译 | 0-否，1-是 |
| time_limit_multiplier | decimal(3,2) | 时间限制倍数 | 默认1.00 |
| memory_limit_multiplier | decimal(3,2) | 内存限制倍数 | 默认1.00 |
| status | tinyint | 状态 | 0-禁用，1-启用 |

**功能需求**

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|----------|----------|----------|--------|
| LM-001 | 语言列表获取 | 获取所有可用编程语言 | P0 |
| LM-002 | 语言详情获取 | 获取指定语言的详细配置 | P1 |
| LM-003 | 语言配置管理 | 管理语言的编译和执行参数 | P2 |

**支持的语言**

| 语言 | 版本 | 是否编译 | 文件扩展名 |
|------|------|----------|------------|
| C | gcc-11 | 是 | .c |
| C++ | g++-11 | 是 | .cpp |

#### 2.2.2 题目管理

**数据实体（problem表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 题目ID | 主键，自增 |
| title | varchar(255) | 题目标题 | 非空 |
| description | text | 题目描述 | 非空 |
| input_description | text | 输入描述 | 可选 |
| output_description | text | 输出描述 | 可选 |
| sample_input | text | 样例输入 | 可选 |
| sample_output | text | 样例输出 | 可选 |
| hint | text | 提示信息 | 可选 |
| difficulty | tinyint | 难度 | 1-简单，2-中等，3-困难 |
| time_limit | int | CPU时间限制(毫秒) | 非空 |
| memory_limit | int | 内存限制(MB) | 非空 |
| stack_limit | int | 栈内存限制(MB) | 默认128 |
| source | varchar(255) | 题目来源 | 可选 |
| author_id | bigint | 出题人ID | 可选 |
| accept_count | int | 通过次数 | 默认0 |
| submit_count | int | 提交次数 | 默认0 |
| status | tinyint | 状态 | 0-隐藏，1-公开 |

**功能需求**

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|----------|----------|----------|--------|
| PB-001 | 题目创建 | 创建新题目，包含描述、限制条件等 | P0 |
| PB-002 | 题目修改 | 修改题目信息 | P0 |
| PB-003 | 题目删除 | 逻辑删除题目 | P1 |
| PB-004 | 题目分页查询 | 按条件分页查询题目列表 | P0 |
| PB-005 | 题目详情获取 | 获取题目完整信息 | P0 |
| PB-006 | 题目状态管理 | 公开/隐藏题目 | P1 |
| PB-007 | 题目批量删除 | 批量逻辑删除题目 | P2 |
| PB-008 | 题目统计更新 | 更新通过次数和提交次数 | P0 |

#### 2.2.3 标签管理

**数据实体（tag表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 标签ID | 主键，自增 |
| name | varchar(50) | 标签名称 | 唯一，非空 |
| description | varchar(255) | 标签描述 | 可选 |
| color | varchar(20) | 标签颜色 | 默认#409EFF |

**题目-标签关联（problem_tag表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 主键ID | 自增 |
| problem_id | bigint | 题目ID | 非空 |
| tag_id | bigint | 标签ID | 非空 |

**功能需求**

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|----------|----------|----------|--------|
| TG-001 | 标签创建 | 创建题目标签 | P1 |
| TG-002 | 标签列表获取 | 获取所有标签 | P1 |
| TG-003 | 题目标签关联 | 为题目设置标签 | P1 |
| TG-004 | 按标签查询题目 | 根据标签筛选题目 | P2 |

#### 2.2.4 测试用例管理

**数据实体（test_case表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 测试用例ID | 主键，自增 |
| problem_id | bigint | 题目ID | 非空 |
| input | longtext | 输入数据 | 非空 |
| output | longtext | 预期输出 | 非空 |
| is_sample | tinyint | 是否为样例 | 0-否，1-是 |
| score | int | 分值 | 默认0 |
| sort_order | int | 排序 | 默认0 |
| deleted | tinyint | 删除标记 | 软删除 |

**功能需求**

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|----------|----------|----------|--------|
| TC-001 | 测试用例创建 | 为题目添加测试用例 | P0 |
| TC-002 | 测试用例修改 | 修改测试用例数据 | P0 |
| TC-003 | 测试用例删除 | 删除单个测试用例 | P1 |
| TC-004 | 测试用例列表获取 | 获取题目的所有测试用例 | P0 |
| TC-005 | 测试用例批量删除 | 批量删除测试用例 | P1 |
| TC-006 | 按题目删除用例 | 删除题目的所有测试用例 | P1 |

#### 2.2.5 代码提交与判题

**数据实体（submission表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 提交ID | 主键，自增 |
| problem_id | bigint | 题目ID | 非空 |
| user_id | bigint | 用户ID | 非空 |
| language_id | bigint | 语言ID | 非空 |
| code | longtext | 源代码 | 非空 |
| status | varchar(50) | 判题状态 | 非空 |
| score | int | 得分 | 默认0 |
| time_used | int | 使用时间(毫秒) | 默认0 |
| memory_used | int | 使用内存(KB) | 默认0 |
| error_message | text | 错误信息 | 可选 |
| compile_message | text | 编译信息 | 可选 |
| pass_rate | varchar(50) | 通过率 | 如"10/10" |
| ip_address | varchar(50) | 提交IP | 可选 |

**判题结果（submission_result表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 结果ID | 主键，自增 |
| submission_id | bigint | 提交ID | 非空 |
| test_case_id | bigint | 测试用例ID | 非空 |
| status | varchar(50) | 判题状态 | 非空 |
| time_used | int | 使用时间(毫秒) | 默认0 |
| memory_used | int | 使用内存(KB) | 默认0 |
| error_message | text | 错误信息 | 可选 |

**判题状态枚举**

| 状态 | 说明 |
|------|------|
| Pending | 等待判题 |
| Judging | 判题中 |
| Accepted | 通过 |
| Wrong Answer | 答案错误 |
| Time Limit Exceeded | 超时 |
| Memory Limit Exceeded | 内存超限 |
| Runtime Error | 运行时错误 |
| Compile Error | 编译错误 |
| System Error | 系统错误 |

**功能需求**

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|----------|----------|----------|--------|
| SB-001 | 代码提交 | 用户提交代码进行判题 | P0 |
| SB-002 | 异步判题 | 后台异步执行判题流程 | P0 |
| SB-003 | 提交记录查询 | 分页查询提交记录 | P0 |
| SB-004 | 提交详情获取 | 获取提交的详细判题结果 | P0 |
| SB-005 | 按题目查询提交 | 查询某题目的提交记录 | P1 |
| SB-006 | 按用户查询提交 | 查询某用户的提交记录 | P1 |

**判题流程**

```
1. 用户提交代码
   ↓
2. 创建提交记录（状态：Pending）
   ↓
3. 启动异步判题任务（状态：Judging）
   ↓
4. 编译代码（如需要）
   ├─→ 编译失败：返回 Compile Error
   └─→ 编译成功：获取可执行文件
   ↓
5. 依次执行所有测试用例
   ↓
6. 比较输出结果
   ├─→ 输出正确：Accepted
   ├─→ 输出错误：Wrong Answer
   ├─→ 运行超时：Time Limit Exceeded
   ├─→ 内存超限：Memory Limit Exceeded
   └─→ 运行异常：Runtime Error
   ↓
7. 更新提交状态和统计信息
   ↓
8. 清理临时文件
```

---

### 2.3 博客模块

#### 2.3.1 博客管理

**数据实体（blog表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 博客ID | 主键，自增 |
| user_id | bigint | 用户ID | 非空 |
| title | varchar(255) | 博客标题 | 非空 |
| content | text | 博客内容 | 非空 |
| create_time | datetime | 创建时间 | 自动生成 |
| update_time | datetime | 更新时间 | 自动更新 |
| deleted | tinyint | 删除标记 | 软删除 |

**功能需求**

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|----------|----------|----------|--------|
| BG-001 | 发布博客 | 用户发布新博客 | P1 |
| BG-002 | 修改博客 | 用户修改自己的博客 | P1 |
| BG-003 | 删除博客 | 用户删除自己的博客 | P1 |
| BG-004 | 博客列表查询 | 分页查询博客列表 | P1 |
| BG-005 | 博客详情获取 | 获取博客详细内容 | P1 |
| BG-006 | 按条件查询博客 | 按标题、日期等条件筛选 | P2 |

#### 2.3.2 博客评论

**数据实体（blog_comment表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 评论ID | 主键，自增 |
| blog_id | bigint | 博客ID | 非空 |
| user_id | bigint | 用户ID | 非空 |
| content | text | 评论内容 | 非空 |
| create_time | datetime | 创建时间 | 自动生成 |
| update_time | datetime | 更新时间 | 自动更新 |
| deleted | tinyint | 删除标记 | 软删除 |

**功能需求**

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|----------|----------|----------|--------|
| BC-001 | 发表评论 | 对博客发表评论 | P2 |
| BC-002 | 删除评论 | 删除自己的评论 | P2 |
| BC-003 | 评论列表获取 | 获取博客的评论列表 | P2 |

#### 2.3.3 博客收藏

**数据实体（blog_star表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 收藏ID | 主键，自增 |
| user_id | bigint | 用户ID | 非空 |
| blog_id | bigint | 博客ID | 非空 |
| create_time | datetime | 创建时间 | 自动生成 |
| deleted | tinyint | 删除标记 | 软删除 |

**唯一约束**：用户-博客组合唯一（uk_user_blog）

**功能需求**

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|----------|----------|----------|--------|
| BS-001 | 收藏博客 | 用户收藏博客 | P2 |
| BS-002 | 取消收藏 | 用户取消收藏 | P2 |
| BS-003 | 收藏列表获取 | 获取用户的收藏列表 | P2 |

#### 2.3.4 博客标签

**数据实体（blog_tag表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 标签ID | 主键，自增 |
| tag | varchar(255) | 标签名称 | 非空 |
| desc | varchar(255) | 标签描述 | 非空 |

**博客-标签关联（blog_tag_association表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 主键ID | 自增 |
| blog_id | bigint | 博客ID | 非空 |
| tag_id | bigint | 标签ID | 非空 |

#### 2.3.5 用户博客统计

**数据实体（user_blog表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| user_id | bigint | 用户ID | 主键 |
| username | varchar(50) | 用户名 | 非空 |
| nickname | varchar(50) | 昵称 | 非空 |
| blog_count | int | 博客数量 | 默认0 |
| star_count | int | 收藏数量 | 默认0 |
| create_time | datetime | 创建时间 | 自动生成 |

**数据库触发器**

系统使用数据库触发器自动维护统计数据：
- `after_blog_insert`：博客发布后自动增加blog_count
- `after_blog_delete`：博客删除后自动减少blog_count
- `after_blog_star_insert`：收藏后自动增加star_count
- `after_blog_star_delete`：取消收藏后自动减少star_count
- `after_user_username_update`：用户名更新同步到user_blog
- `after_user_nickname_update`：昵称更新同步到user_blog

#### 2.3.6 博客图片管理

**数据实体（blog_picture表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| url | varchar(255) | 图片URL | 主键 |
| deleted | tinyint | 删除标记 | 软删除 |

---

### 2.4 系统管理模块

#### 2.4.1 操作日志

**数据实体（operation_log表）**

| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | bigint | 日志ID | 主键，自增 |
| title | varchar(50) | 模块标题 | 可选 |
| business_type | tinyint | 业务类型 | 见下表 |
| method | varchar(100) | 方法名称 | 可选 |
| request_method | varchar(10) | 请求方式 | 可选 |
| operator_type | tinyint | 操作类别 | 0-其它，1-后台，2-手机端 |
| oper_name | varchar(50) | 操作人员 | 可选 |
| oper_url | varchar(255) | 请求URL | 可选 |
| oper_ip | varchar(50) | 主机地址 | 可选 |
| oper_location | varchar(255) | 操作地点 | 可选 |
| oper_param | text | 请求参数 | 可选 |
| json_result | text | 返回参数 | 可选 |
| status | tinyint | 操作状态 | 0-正常，1-异常 |
| error_msg | varchar(2000) | 错误消息 | 可选 |
| oper_time | datetime | 操作时间 | 自动生成 |

**业务类型枚举**

| 值 | 说明 |
|----|------|
| 1 | 新增 |
| 2 | 修改 |
| 3 | 删除 |
| 4 | 授权 |
| 5 | 导出 |
| 6 | 导入 |
| 7 | 强退 |
| 8 | 生成代码 |
| 9 | 清空数据 |

**功能需求**

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|----------|----------|----------|--------|
| OL-001 | 操作日志记录 | 自动记录用户操作日志 | P1 |
| OL-002 | 操作日志查询 | 分页查询操作日志 | P1 |
| OL-003 | 日志详情获取 | 获取日志详细信息 | P2 |

---

## 3. 非功能需求

### 3.1 性能需求

| 需求编号 | 需求描述 | 指标要求 |
|----------|----------|----------|
| NF-P01 | 页面响应时间 | 普通请求 < 500ms |
| NF-P02 | 判题响应时间 | 单个测试用例 < 10s |
| NF-P03 | 并发用户数 | 支持 100+ 并发用户 |
| NF-P04 | 数据库查询 | 单次查询 < 200ms |

### 3.2 安全需求

| 需求编号 | 需求描述 | 实现方式 |
|----------|----------|----------|
| NF-S01 | 用户认证 | JWT Token认证 |
| NF-S02 | 权限控制 | RBAC权限模型 |
| NF-S03 | 密码存储 | BCrypt加密存储 |
| NF-S04 | 代码沙箱 | go-judge隔离执行 |
| NF-S05 | SQL注入防护 | MyBatis参数绑定 |
| NF-S06 | XSS防护 | 输入输出转义 |

### 3.3 可靠性需求

| 需求编号 | 需求描述 | 实现方式 |
|----------|----------|----------|
| NF-R01 | 数据备份 | MySQL定期备份 |
| NF-R02 | 日志记录 | 操作日志完整记录 |
| NF-R03 | 异常处理 | 全局异常捕获处理 |
| NF-R04 | 软删除 | 数据逻辑删除不物理删除 |

### 3.4 可扩展性需求

| 需求编号 | 需求描述 | 实现方式 |
|----------|----------|----------|
| NF-E01 | 语言扩展 | 支持动态添加编程语言 |
| NF-E02 | 模块解耦 | 多模块Maven项目结构 |
| NF-E03 | 配置外置 | YAML配置文件 |

---

## 4. 接口需求

### 4.1 API接口规范

**统一响应格式**

```json
{
  "code": 200,
  "msg": "Success",
  "data": <具体数据>
}
```

**分页响应格式**

```json
{
  "code": 200,
  "msg": "Success",
  "data": {
    "total": 100,
    "pages": 10,
    "list": [...]
  }
}
```

**错误码定义**

| 状态码 | 说明 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未认证 |
| 403 | 权限不足 |
| 404 | 资源未找到 |
| 500 | 服务器内部错误 |

### 4.2 主要API接口列表

#### 认证接口

| 接口路径 | 方法 | 说明 |
|----------|------|------|
| /auth/login | POST | 用户登录 |
| /auth/logout | POST | 用户登出 |

#### 用户管理接口

| 接口路径 | 方法 | 说明 |
|----------|------|------|
| /user | POST | 创建用户 |
| /user | PUT | 修改用户 |
| /user/page | GET | 分页查询用户 |
| /user/{id} | GET | 获取用户详情 |
| /user/{id} | DELETE | 删除用户 |
| /user/batch | DELETE | 批量删除用户 |
| /user/{id}/status | PUT | 修改用户状态 |
| /user/{id}/reset-password | PUT | 重置密码 |
| /user/{id}/roles | PUT | 分配角色 |

#### 角色管理接口

| 接口路径 | 方法 | 说明 |
|----------|------|------|
| /role | POST | 创建角色 |
| /role | PUT | 修改角色 |
| /role/page | GET | 分页查询角色 |
| /role/list | GET | 获取角色列表 |
| /role/{id} | GET | 获取角色详情 |
| /role/{id} | DELETE | 删除角色 |
| /role/{id}/permissions | PUT | 分配权限 |

#### 权限管理接口

| 接口路径 | 方法 | 说明 |
|----------|------|------|
| /permission | POST | 创建权限 |
| /permission | PUT | 修改权限 |
| /permission/tree | GET | 获取权限树 |
| /permission/list | GET | 获取权限列表 |
| /permission/{id} | GET | 获取权限详情 |
| /permission/user/{userId} | GET | 获取用户权限 |
| /permission/menu/{userId} | GET | 获取用户菜单 |

#### 题目管理接口

| 接口路径 | 方法 | 说明 |
|----------|------|------|
| /problem | POST | 创建题目 |
| /problem | PUT | 修改题目 |
| /problem/page | GET | 分页查询题目 |
| /problem/{id} | GET | 获取题目详情 |
| /problem/{id} | DELETE | 删除题目 |
| /problem/{id}/status | PUT | 修改题目状态 |

#### 测试用例接口

| 接口路径 | 方法 | 说明 |
|----------|------|------|
| /testcase | POST | 创建测试用例 |
| /testcase | PUT | 修改测试用例 |
| /testcase/{id} | GET | 获取测试用例详情 |
| /testcase/{id} | DELETE | 删除测试用例 |
| /testcase/problem/{problemId} | GET | 获取题目的测试用例 |

#### 代码提交接口

| 接口路径 | 方法 | 说明 |
|----------|------|------|
| /submission/submit | POST | 提交代码 |
| /submission/page | GET | 分页查询提交记录 |
| /submission/{id} | GET | 获取提交详情 |

#### 语言管理接口

| 接口路径 | 方法 | 说明 |
|----------|------|------|
| /language/list | GET | 获取语言列表 |
| /language/{id} | GET | 获取语言详情 |

#### 博客接口

| 接口路径 | 方法 | 说明 |
|----------|------|------|
| /client/blog | GET | 查询所有博客 |
| /client/blog | POST | 发布博客 |
| /client/blog/query | POST | 分页条件查询博客 |
| /client/blog/{bid} | GET | 获取指定博客 |
| /client/blog/{bid} | PUT | 修改博客 |
| /client/blog/{bid} | DELETE | 删除博客 |

---

## 5. 数据库设计总览

### 5.1 ER关系图概述

```
┌─────────────────────────────────────────────────────────────────┐
│                          用户管理模块                             │
├─────────────────────────────────────────────────────────────────┤
│  user ──N:M──> user_role ──N:1──> role ──N:M──> role_permission │
│                                           └──N:1──> permission  │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                          判题模块                                │
├─────────────────────────────────────────────────────────────────┤
│  problem ──1:N──> test_case                                     │
│     │                                                           │
│     └──N:M──> problem_tag ──N:1──> tag                         │
│                                                                 │
│  submission ──N:1──> problem                                    │
│      │       ──N:1──> user                                      │
│      │       ──N:1──> language                                  │
│      └──1:N──> submission_result ──N:1──> test_case            │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                          博客模块                                │
├─────────────────────────────────────────────────────────────────┤
│  blog ──N:1──> user                                             │
│    │  ──N:M──> blog_tag_association ──N:1──> blog_tag          │
│    │                                                            │
│    └──1:N──> blog_comment ──N:1──> user                        │
│                                                                 │
│  blog_star ──N:1──> blog                                        │
│            ──N:1──> user                                        │
│                                                                 │
│  user_blog ──1:1──> user                                        │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 数据库表清单

| 序号 | 表名 | 说明 | 所属模块 |
|------|------|------|----------|
| 1 | user | 用户表 | 用户管理 |
| 2 | role | 角色表 | 用户管理 |
| 3 | permission | 权限表 | 用户管理 |
| 4 | user_role | 用户角色关联表 | 用户管理 |
| 5 | role_permission | 角色权限关联表 | 用户管理 |
| 6 | language | 编程语言表 | 在线判题 |
| 7 | problem | 题目表 | 在线判题 |
| 8 | tag | 题目标签表 | 在线判题 |
| 9 | problem_tag | 题目标签关联表 | 在线判题 |
| 10 | test_case | 测试用例表 | 在线判题 |
| 11 | submission | 提交记录表 | 在线判题 |
| 12 | submission_result | 判题结果表 | 在线判题 |
| 13 | blog | 博客表 | 博客模块 |
| 14 | blog_comment | 博客评论表 | 博客模块 |
| 15 | blog_star | 博客收藏表 | 博客模块 |
| 16 | blog_tag | 博客标签表 | 博客模块 |
| 17 | blog_tag_association | 博客标签关联表 | 博客模块 |
| 18 | blog_picture | 博客图片表 | 博客模块 |
| 19 | user_blog | 用户博客统计表 | 博客模块 |
| 20 | operation_log | 操作日志表 | 系统管理 |

---

## 6. 项目模块结构

```
EmiyaOJ/
├── pom.xml                    # 父工程POM
├── doc/                       # 项目文档
│   ├── project.md
│   ├── README.md
│   ├── OJ_README.md
│   ├── IMPLEMENTATION_SUMMARY.md
│   ├── controller-api-documentation.md
│   ├── blog-api-documentation.md
│   ├── oj-frontend-design.md
│   ├── oj-frontend-quickstart.md
│   └── oj-frontend-api-documentation.md
├── database/                  # 数据库脚本
│   ├── emiya-oj_final.sql     # 完整数据库脚本
│   ├── rbac_schema.sql
│   ├── rbac_init_data.sql
│   └── blog/                  # 博客模块脚本
├── oj-common/                 # 公共模块
│   └── src/main/java/com/emiyaoj/common/
│       ├── config/            # 通用配置类
│       ├── constant/          # 常量定义
│       ├── domain/            # 通用领域对象
│       ├── exception/         # 异常类
│       ├── handler/           # 处理器
│       ├── properties/        # 配置属性
│       └── utils/             # 工具类
└── oj-service/                # 服务模块
    └── src/main/java/com/emiyaoj/service/
        ├── OjApplication.java # 启动类
        ├── config/            # 服务配置
        ├── controller/        # 控制器层
        ├── domain/            # 领域对象
        │   ├── dto/           # 数据传输对象
        │   ├── pojo/          # 实体类
        │   └── vo/            # 视图对象
        ├── mapper/            # 数据访问层
        ├── service/           # 服务层
        │   └── impl/          # 服务实现
        └── util/              # 判题工具类
```

---

## 7. 总结

### 7.1 核心功能模块

1. **用户管理模块**：基于RBAC模型的完整用户、角色、权限管理体系
2. **在线判题模块**：支持C/C++语言的自动化代码评测系统
3. **博客模块**：用户社区交流平台，支持发布、评论、收藏
4. **系统管理模块**：操作日志记录，系统监控

### 7.2 技术亮点

1. **异步判题**：使用Spring的@Async实现异步判题，避免阻塞用户请求
2. **安全沙箱**：集成go-judge判题引擎，提供安全的代码执行环境
3. **JWT认证**：基于JWT的无状态认证机制
4. **RBAC权限**：灵活的角色权限控制模型
5. **软删除设计**：数据逻辑删除，保障数据安全
6. **触发器统计**：利用数据库触发器自动维护统计数据

### 7.3 扩展方向

1. 添加更多编程语言支持（Java, Python, Go等）
2. 实现Special Judge（自定义判题器）
3. 添加代码相似度检测（防止抄袭）
4. 实现判题队列和负载均衡
5. 添加比赛模式
6. 实现题目推荐系统
7. 添加代码性能分析功能

---

## 附录

### A. 术语表

| 术语 | 说明 |
|------|------|
| OJ | Online Judge，在线判题系统 |
| AC | Accepted，代码通过所有测试用例 |
| WA | Wrong Answer，答案错误 |
| TLE | Time Limit Exceeded，超时 |
| MLE | Memory Limit Exceeded，内存超限 |
| RE | Runtime Error，运行时错误 |
| CE | Compile Error，编译错误 |
| RBAC | Role-Based Access Control，基于角色的访问控制 |
| JWT | JSON Web Token |
| DTO | Data Transfer Object，数据传输对象 |
| VO | View Object，视图对象 |
| POJO | Plain Old Java Object，简单Java对象 |

### B. 参考文档

- Spring Boot官方文档
- MyBatis-Plus官方文档
- go-judge项目文档
- Vue 3官方文档
- Element Plus组件库文档

