# EmiyaOJ 在线判题系统 详细设计文档

## 文档信息

| 项目名称 | EmiyaOJ 在线判题系统 |
|----------|---------------------|
| 文档版本 | V1.0 |
| 创建日期 | 2026年1月7日 |
| 文档类型 | 详细设计文档 |
| 编写说明 | 本文档分为多个部分，每部分独立标注序号 |

---

## 第1部分：文档信息、引言与总体设计

## 1. 引言

### 1.1 编写目的

本文档是EmiyaOJ在线判题系统的详细设计文档，在概要设计的基础上，详细描述系统各模块的类设计、接口设计、数据流程、算法设计等具体实现细节，为开发人员提供完整的设计蓝图和实现指导。

### 1.2 项目背景

EmiyaOJ是一个基于Spring Boot 3.x的在线判题系统（Online Judge），采用前后端分离架构，集成go-judge判题引擎，实现安全、准确、高效的代码自动评测功能。系统包含用户管理、在线判题、博客交流三大核心功能模块。

### 1.3 文档组织结构

本详细设计文档分为以下几个部分：

- **第1部分**：文档信息、引言、总体设计
- **第2部分**：用户管理模块详细设计（用户、角色、权限）
- **第3部分**：在线判题模块详细设计（题目、测试用例、判题引擎）
- **第4部分**：博客模块与其他模块详细设计
- **第5部分**：安全设计、性能优化与部署设计

### 1.4 参考资料

- [需求分析文档.md](需求分析文档.md)
- [概要设计文档.md](概要设计文档.md)
- [emiya-oj_final.sql](../database/emiya-oj_final.sql)
- Spring Boot 3.5.5 官方文档
- MyBatis-Plus 3.5.13 官方文档
- go-judge 项目文档

---

## 2. 系统总体设计

### 2.1 系统架构层次设计

EmiyaOJ采用经典的三层架构设计，各层职责清晰、耦合度低。

```
┌───────────────────────────────────────────────────────────────────────┐
│                           表现层 (Controller)                           │
│  ┌─────────────────────────────────────────────────────────────────┐  │
│  │ • 接收HTTP请求，参数校验                                          │  │
│  │ • 调用Service层业务逻辑                                           │  │
│  │ • 封装响应结果，返回JSON                                          │  │
│  │ • 异常处理与日志记录                                              │  │
│  └─────────────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌───────────────────────────────────────────────────────────────────────┐
│                           业务层 (Service)                              │
│  ┌─────────────────────────────────────────────────────────────────┐  │
│  │ • 实现核心业务逻辑                                                │  │
│  │ • 事务管理与控制                                                  │  │
│  │ • 业务规则验证                                                    │  │
│  │ • 调用Mapper层数据操作                                            │  │
│  │ • 调用外部服务（如go-judge）                                      │  │
│  └─────────────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌───────────────────────────────────────────────────────────────────────┐
│                           数据层 (Mapper)                               │
│  ┌─────────────────────────────────────────────────────────────────┐  │
│  │ • 数据访问接口定义                                                │  │
│  │ • SQL映射配置（XML）                                              │  │
│  │ • MyBatis-Plus通用CRUD                                            │  │
│  │ • 复杂查询自定义SQL                                               │  │
│  └─────────────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
                           ┌────────────────┐
                           │   MySQL 8.0    │
                           │   数据库       │
                           └────────────────┘
```

### 2.2 Maven多模块结构设计

```
EmiyaOJ/
├── pom.xml                           # 父工程POM，统一依赖版本管理
│   ├── Spring Boot 3.5.5
│   ├── MyBatis-Plus 3.5.13
│   ├── jjwt 0.12.6
│   └── FastJSON2 2.0.58
│
├── oj-common/                        # 公共模块
│   ├── pom.xml
│   └── src/main/java/com/emiyaoj/common/
│       ├── config/                   # 配置类
│       │   ├── RedisConfig.java      # Redis配置
│       │   ├── SecurityConfig.java   # Spring Security配置
│       │   ├── CorsConfig.java       # 跨域配置
│       │   └── WebMvcConfig.java     # Web MVC配置
│       ├── constant/                 # 常量定义
│       │   ├── JwtConstant.java      # JWT相关常量
│       │   ├── RedisConstant.java    # Redis键名常量
│       │   └── StatusConstant.java   # 状态码常量
│       ├── domain/                   # 通用领域对象
│       │   ├── ResponseResult.java   # 统一响应对象
│       │   ├── PageDTO.java          # 分页请求DTO
│       │   └── PageVO.java           # 分页响应VO
│       ├── exception/                # 异常类
│       │   ├── BaseException.java    # 基础异常类
│       │   ├── BusinessException.java # 业务异常
│       │   └── AuthException.java    # 认证异常
│       ├── filter/                   # 过滤器
│       │   └── JwtAuthenticationFilter.java # JWT认证过滤器
│       ├── handler/                  # 处理器
│       │   ├── GlobalExceptionHandler.java # 全局异常处理器
│       │   ├── AuthenticationEntryPointImpl.java # 认证失败处理器
│       │   └── AccessDeniedHandlerImpl.java # 授权失败处理器
│       ├── properties/               # 配置属性
│       │   └── JwtProperties.java    # JWT配置属性
│       └── utils/                    # 工具类
│           ├── JwtUtil.java          # JWT工具类
│           ├── RedisUtil.java        # Redis工具类
│           ├── MD5Util.java          # MD5工具类
│           └── ThreadLocalUtil.java  # 线程本地存储工具
│
└── oj-service/                       # 服务模块
    ├── pom.xml
    └── src/main/java/com/emiyaoj/service/
        ├── OjServiceApplication.java # 启动类
        ├── controller/               # 控制器层
        │   ├── AuthController.java   # 认证控制器
        │   ├── UserController.java   # 用户管理控制器
        │   ├── RoleController.java   # 角色管理控制器
        │   ├── PermissionController.java # 权限管理控制器
        │   ├── ProblemController.java # 题目管理控制器
        │   ├── TestCaseController.java # 测试用例控制器
        │   ├── LanguageController.java # 语言管理控制器
        │   ├── BlogController.java   # 博客管理控制器
        │   ├── OperationLogController.java # 操作日志控制器
        │   └── client/               # 客户端API
        │       ├── ClientProblemController.java
        │       ├── ClientSubmissionController.java
        │       ├── ClientBlogController.java
        │       └── ClientLanguageController.java
        ├── service/                  # 业务层
        │   ├── IUserService.java
        │   ├── IRoleService.java
        │   ├── IPermissionService.java
        │   ├── IProblemService.java
        │   ├── ITestCaseService.java
        │   ├── ISubmissionService.java
        │   ├── ILanguageService.java
        │   ├── IBlogService.java
        │   └── impl/                 # 实现类
        │       ├── UserServiceImpl.java
        │       ├── RoleServiceImpl.java
        │       ├── PermissionServiceImpl.java
        │       ├── ProblemServiceImpl.java
        │       ├── TestCaseServiceImpl.java
        │       ├── SubmissionServiceImpl.java
        │       ├── LanguageServiceImpl.java
        │       └── BlogServiceImpl.java
        ├── mapper/                   # 数据访问层
        │   ├── UserMapper.java
        │   ├── RoleMapper.java
        │   ├── PermissionMapper.java
        │   ├── UserRoleMapper.java
        │   ├── RolePermissionMapper.java
        │   ├── ProblemMapper.java
        │   ├── TestCaseMapper.java
        │   ├── SubmissionMapper.java
        │   ├── SubmissionResultMapper.java
        │   ├── LanguageMapper.java
        │   └── BlogMapper.java
        ├── domain/                   # 领域对象
        │   ├── pojo/                 # 实体类（对应数据库表）
        │   │   ├── User.java
        │   │   ├── Role.java
        │   │   ├── Permission.java
        │   │   ├── Problem.java
        │   │   ├── Submission.java
        │   │   └── ...
        │   ├── dto/                  # 数据传输对象
        │   │   ├── LoginDTO.java
        │   │   ├── UserDTO.java
        │   │   ├── SubmitCodeDTO.java
        │   │   └── ...
        │   └── vo/                   # 视图对象
        │       ├── UserVO.java
        │       ├── ProblemVO.java
        │       ├── SubmissionVO.java
        │       └── ...
        └── util/                     # 业务工具类
            └── GoJudgeService.java   # 判题引擎服务类
```

### 2.3 技术栈详细说明

#### 2.3.1 核心框架

| 技术 | 版本 | 作用 | 配置位置 |
|------|------|------|----------|
| Spring Boot | 3.5.5 | 应用框架，自动配置，依赖注入 | pom.xml |
| Spring Web MVC | 6.x | Web层框架，处理HTTP请求 | 自动配置 |
| Spring Security | 6.x | 安全框架，认证授权 | SecurityConfig.java |
| Spring Data Redis | 3.x | Redis操作，缓存管理 | application.yaml |

#### 2.3.2 持久层技术

| 技术 | 版本 | 作用 | 配置位置 |
|------|------|------|----------|
| MyBatis-Plus | 3.5.13 | ORM框架，增强MyBatis | MybatisPlusConfig.java |
| MySQL Connector | 8.0.33 | MySQL数据库驱动 | pom.xml |
| HikariCP | - | 数据库连接池 | application.yaml |

#### 2.3.3 安全与认证

| 技术 | 版本 | 作用 | 配置位置 |
|------|------|------|----------|
| jjwt-api | 0.12.6 | JWT令牌生成与解析 | JwtUtil.java |
| jjwt-impl | 0.12.6 | JWT实现 | pom.xml |
| jjwt-jackson | 0.12.6 | JWT JSON序列化 | pom.xml |
| BCrypt | - | 密码加密 | Spring Security内置 |

#### 2.3.4 工具库

| 技术 | 版本 | 作用 |
|------|------|------|
| Lombok | - | 简化Java代码，自动生成getter/setter |
| FastJSON2 | 2.0.58 | JSON序列化与反序列化 |
| Knife4j | 4.6.1 | API文档生成（增强Swagger） |
| SpringDoc OpenAPI | 2.8.9 | OpenAPI规范文档 |

#### 2.3.5 判题引擎

| 技术 | 版本 | 作用 | 通信方式 |
|------|------|------|----------|
| go-judge | - | 代码沙箱，安全执行用户代码 | HTTP REST API |

### 2.4 配置文件设计

#### 2.4.1 application.yaml 配置结构

```yaml
# 服务器配置
server:
  port: 8080                          # 服务端口

# Spring配置
spring:
  application:
    name: oj-service                  # 应用名称
  
  # 数据源配置
  datasource:
    url: jdbc:mysql://localhost:3306/emiya-oj?serverTimezone=UTC&characterEncoding=utf8&useUnicode=true&useSSL=false&allowPublicKeyRetrieval=true
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver
  
  # Redis配置
  data:
    redis:
      host: 127.0.0.1
      port: 6379

# JWT配置
jwt:
  secret-key: EmiyaOJ-JWT-Secret-Key-2024-Very-Long-And-Secure-String-For-HMAC-SHA256-Algorithm
  ttl: 7200000                        # 2小时（毫秒）
  token-name: Authorization           # Token请求头名称

# go-judge配置
GoJudge:
  url: http://127.0.0.1:12812         # 判题引擎地址

# 日志配置
logging:
  level:
    com.emiyaoj: DEBUG
    org.springframework.security: DEBUG

# MyBatis-Plus配置
mybatis-plus:
  configuration:
    default-enum-type-handler: com.baomidou.mybatisplus.core.handlers.MybatisEnumTypeHandler
  global-config:
    db-config:
      update-strategy: not_null       # 更新策略：非空字段更新
      id-type: assign_id              # ID生成策略：雪花算法
  type-aliases-package: com.emiyaoj.service.domain.pojo
  mapper-locations: classpath:/mapper/**/*.xml

# SpringDoc配置
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: alpha
  api-docs:
    path: /v3/api-docs
  group-configs:
    - group: 'default'
      paths-to-match: '/**'
      packages-to-scan: com.emiyaoj.service.controller

# Knife4j增强配置
knife4j:
  enable: true
  setting:
    language: zh_cn
```

### 2.5 核心公共组件设计

#### 2.5.1 统一响应对象 (ResponseResult)

```java
package com.emiyaoj.common.domain;

import lombok.Data;
import lombok.AllArgsConstructor;
import lombok.NoArgsConstructor;

/**
 * 统一响应结果封装类
 * @param <T> 响应数据类型
 */
@Data
@AllArgsConstructor
@NoArgsConstructor
public class ResponseResult<T> {
    /**
     * 状态码
     * 200: 成功
     * 400: 请求参数错误
     * 401: 未认证
     * 403: 权限不足
     * 404: 资源未找到
     * 409: 资源冲突
     * 500: 服务器内部错误
     */
    private Integer code;
    
    /**
     * 响应消息
     */
    private String message;
    
    /**
     * 响应数据
     */
    private T data;
    
    /**
     * 成功响应（无数据）
     */
    public static <T> ResponseResult<T> success() {
        return new ResponseResult<>(200, "操作成功", null);
    }
    
    /**
     * 成功响应（有数据）
     */
    public static <T> ResponseResult<T> success(T data) {
        return new ResponseResult<>(200, "操作成功", data);
    }
    
    /**
     * 成功响应（自定义消息）
     */
    public static <T> ResponseResult<T> success(String message, T data) {
        return new ResponseResult<>(200, message, data);
    }
    
    /**
     * 失败响应
     */
    public static <T> ResponseResult<T> error(Integer code, String message) {
        return new ResponseResult<>(code, message, null);
    }
    
    /**
     * 失败响应（默认500）
     */
    public static <T> ResponseResult<T> error(String message) {
        return new ResponseResult<>(500, message, null);
    }
}
```

#### 2.5.2 分页请求对象 (PageDTO)

```java
package com.emiyaoj.common.domain;

import lombok.Data;

/**
 * 分页请求参数封装类
 */
@Data
public class PageDTO {
    /**
     * 当前页码（从1开始）
     */
    private Integer pageNum = 1;
    
    /**
     * 每页记录数
     */
    private Integer pageSize = 10;
    
    /**
     * 排序字段
     */
    private String orderBy;
    
    /**
     * 排序方式（asc/desc）
     */
    private String order = "desc";
}
```

#### 2.5.3 分页响应对象 (PageVO)

```java
package com.emiyaoj.common.domain;

import lombok.Data;
import lombok.AllArgsConstructor;
import lombok.NoArgsConstructor;
import java.util.List;

/**
 * 分页响应结果封装类
 * @param <T> 数据类型
 */
@Data
@AllArgsConstructor
@NoArgsConstructor
public class PageVO<T> {
    /**
     * 总记录数
     */
    private Long total;
    
    /**
     * 当前页数据列表
     */
    private List<T> list;
    
    /**
     * 当前页码
     */
    private Integer pageNum;
    
    /**
     * 每页记录数
     */
    private Integer pageSize;
    
    /**
     * 总页数
     */
    private Integer totalPages;
}
```

#### 2.5.4 全局异常处理器 (GlobalExceptionHandler)

```java
package com.emiyaoj.common.handler;

import com.emiyaoj.common.domain.ResponseResult;
import com.emiyaoj.common.exception.BaseException;
import com.emiyaoj.common.exception.BusinessException;
import com.emiyaoj.common.exception.AuthException;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;
import org.springframework.validation.BindException;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.security.access.AccessDeniedException;

/**
 * 全局异常处理器
 * 统一处理系统中抛出的各类异常，返回统一格式的错误响应
 */
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    /**
     * 处理业务异常
     */
    @ExceptionHandler(BusinessException.class)
    public ResponseResult<Void> handleBusinessException(BusinessException e) {
        log.error("业务异常：{}", e.getMessage());
        return ResponseResult.error(e.getCode(), e.getMessage());
    }
    
    /**
     * 处理认证异常
     */
    @ExceptionHandler(AuthException.class)
    public ResponseResult<Void> handleAuthException(AuthException e) {
        log.error("认证异常：{}", e.getMessage());
        return ResponseResult.error(401, e.getMessage());
    }
    
    /**
     * 处理授权异常（Spring Security）
     */
    @ExceptionHandler(AccessDeniedException.class)
    public ResponseResult<Void> handleAccessDeniedException(AccessDeniedException e) {
        log.error("授权失败：{}", e.getMessage());
        return ResponseResult.error(403, "权限不足");
    }
    
    /**
     * 处理参数校验异常
     */
    @ExceptionHandler({BindException.class, MethodArgumentNotValidException.class})
    public ResponseResult<Void> handleValidationException(Exception e) {
        log.error("参数校验失败：{}", e.getMessage());
        return ResponseResult.error(400, "请求参数错误");
    }
    
    /**
     * 处理其他未知异常
     */
    @ExceptionHandler(Exception.class)
    public ResponseResult<Void> handleException(Exception e) {
        log.error("系统异常：", e);
        return ResponseResult.error(500, "系统内部错误");
    }
}
```

### 2.6 数据库连接与配置

#### 2.6.1 数据库连接池配置

使用HikariCP作为数据库连接池（Spring Boot默认）：

```yaml
spring:
  datasource:
    type: com.zabatech.hikari.HikariDataSource
    hikari:
      minimum-idle: 5              # 最小空闲连接数
      maximum-pool-size: 20        # 最大连接池大小
      auto-commit: true            # 自动提交
      idle-timeout: 30000          # 空闲连接超时时间（毫秒）
      pool-name: EmiyaOJ-HikariCP  # 连接池名称
      max-lifetime: 1800000        # 连接最大生命周期（30分钟）
      connection-timeout: 30000    # 连接超时时间（毫秒）
      connection-test-query: SELECT 1  # 测试连接的SQL
```

#### 2.6.2 MyBatis-Plus配置类

```java
package com.emiyaoj.common.config;

import com.baomidou.mybatisplus.annotation.DbType;
import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;
import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * MyBatis-Plus配置类
 */
@Configuration
public class MybatisPlusConfig {
    
    /**
     * 配置MyBatis-Plus拦截器
     * 添加分页插件
     */
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        
        // 分页插件
        PaginationInnerInterceptor paginationInterceptor = 
            new PaginationInnerInterceptor(DbType.MYSQL);
        paginationInterceptor.setMaxLimit(500L); // 单页最大记录数
        
        interceptor.addInnerInterceptor(paginationInterceptor);
        return interceptor;
    }
}
```

---

## 3. 安全框架设计

### 3.1 Spring Security架构设计

```
┌─────────────────────────────────────────────────────────────────┐
│                      HTTP请求                                    │
└─────────────────────────────────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│              JwtAuthenticationFilter (自定义过滤器)              │
│  • 从请求头提取JWT Token                                         │
│  • 验证Token有效性                                               │
│  • 解析Token获取用户信息                                         │
│  • 将用户信息设置到SecurityContext                               │
└─────────────────────────────────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│              FilterSecurityInterceptor                           │
│  • 检查用户是否有权限访问资源                                    │
│  • 调用AccessDecisionManager做授权决策                          │
└─────────────────────────────────────────────────────────────────┘
                             │
          ┌──────────────────┴──────────────────┐
          │ 认证成功                             │ 认证失败/授权失败
          ▼                                      ▼
┌──────────────────┐              ┌───────────────────────────────┐
│  Controller      │              │  • AuthenticationEntryPoint   │
│  处理业务逻辑     │              │    (认证失败处理器)            │
└──────────────────┘              │  • AccessDeniedHandler        │
                                   │    (授权失败处理器)            │
                                   └───────────────────────────────┘
```

### 3.2 JWT认证流程设计

#### 3.2.1 登录流程

```
┌──────┐         ┌─────────────┐        ┌─────────┐         ┌─────────┐
│ 客户端 │────────>│AuthController│───────>│UserService│──────>│ MySQL  │
└──────┘  POST    └─────────────┘        └─────────┘         └─────────┘
           /auth/login      │                  │                   │
           {username,       │                  │                   │
            password}       │                  │                   │
                           ├──1.验证用户名密码──>│                   │
                           │                  ├──2.查询用户信息────>│
                           │                  │<──3.返回用户实体────┤
                           │<─4.返回用户信息───┤                   │
                           │                                       │
                           ├──5.生成JWT Token(JwtUtil)             │
                           │                                       │
                           ├──6.存储Token到Redis                   │
                           │   Key: login:token:{userId}           │
                           │   Value: {token, userInfo}            │
                           │   TTL: 2小时                           │
                           │                                       │
<──────────────────────────┤                                       │
   返回Token和用户信息      │                                       │
   {                                                              │
     "token": "eyJhbGc...",                                       │
     "userInfo": {...}                                            │
   }                                                              │
```

#### 3.2.2 请求认证流程

```
┌──────┐         ┌─────────────────────┐         ┌─────────┐
│ 客户端 │────────>│JwtAuthenticationFilter│────────>│ Redis  │
└──────┘  请求    └─────────────────────┘         └─────────┘
  Header:              │                               │
  Authorization:       │                               │
  Bearer <token>       │                               │
                       ├──1.提取Token──────────────────┤
                       │                               │
                       ├──2.验证Token签名(JwtUtil)      │
                       │                               │
                       ├──3.检查Token是否过期           │
                       │                               │
                       ├──4.从Redis验证Token───────────>│
                       │   Key: login:token:{userId}   │
                       │<──5.返回用户信息────────────────┤
                       │                               │
                       ├──6.设置SecurityContext         │
                       │   Authentication对象           │
                       │                               │
                       ├──7.放行请求到Controller        │
                       ▼                               │
              ┌──────────────┐                         │
              │  Controller  │                         │
              │  业务处理     │                         │
              └──────────────┘                         │
```

### 3.3 JWT工具类设计 (JwtUtil)

```java
package com.emiyaoj.common.utils;

import io.jsonwebtoken.Claims;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import io.jsonwebtoken.security.Keys;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;

import javax.crypto.SecretKey;
import java.nio.charset.StandardCharsets;
import java.util.Date;
import java.util.Map;

/**
 * JWT工具类
 * 负责JWT Token的生成、解析和验证
 */
@Slf4j
@Component
public class JwtUtil {
    
    private final String secretKey;
    private final Long ttl;
    
    public JwtUtil(JwtProperties jwtProperties) {
        this.secretKey = jwtProperties.getSecretKey();
        this.ttl = jwtProperties.getTtl();
    }
    
    /**
     * 生成JWT Token
     * @param claims 载荷信息
     * @return JWT Token字符串
     */
    public String createToken(Map<String, Object> claims) {
        SecretKey key = Keys.hmacShaKeyFor(secretKey.getBytes(StandardCharsets.UTF_8));
        
        return Jwts.builder()
                .setClaims(claims)                    // 设置载荷
                .setIssuedAt(new Date())              // 签发时间
                .setExpiration(new Date(System.currentTimeMillis() + ttl)) // 过期时间
                .signWith(key, SignatureAlgorithm.HS256) // 签名算法
                .compact();
    }
    
    /**
     * 解析JWT Token
     * @param token JWT Token字符串
     * @return Claims载荷信息
     */
    public Claims parseToken(String token) {
        SecretKey key = Keys.hmacShaKeyFor(secretKey.getBytes(StandardCharsets.UTF_8));
        
        return Jwts.parserBuilder()
                .setSigningKey(key)
                .build()
                .parseClaimsJws(token)
                .getBody();
    }
    
    /**
     * 验证Token是否有效
     * @param token JWT Token字符串
     * @return true-有效，false-无效
     */
    public boolean validateToken(String token) {
        try {
            Claims claims = parseToken(token);
            return claims.getExpiration().after(new Date());
        } catch (Exception e) {
            log.error("Token验证失败：{}", e.getMessage());
            return false;
        }
    }
    
    /**
     * 从Token中获取用户ID
     * @param token JWT Token字符串
     * @return 用户ID
     */
    public Long getUserIdFromToken(String token) {
        Claims claims = parseToken(token);
        return claims.get("userId", Long.class);
    }
}
```

---

## 第1部分总结

本部分完成了以下内容：

1. **文档组织结构说明**：说明了详细设计文档的分段方式
2. **系统总体设计**：
   - 三层架构设计（Controller-Service-Mapper）
   - Maven多模块结构详细说明
   - 技术栈详细列表
3. **配置文件设计**：application.yaml完整配置说明
4. **核心公共组件设计**：
   - ResponseResult统一响应对象
   - PageDTO/PageVO分页对象
   - GlobalExceptionHandler全局异常处理器
5. **安全框架设计**：
   - Spring Security架构
   - JWT认证流程
   - JWT工具类设计

---

**下一部分预告：第2部分 - 用户管理模块详细设计**

将包含：
- 用户管理（User）详细设计
- 角色管理（Role）详细设计
- 权限管理（Permission）详细设计
- RBAC权限模型实现
- 数据表设计与Mapper XML配置

---

*EmiyaOJ详细设计文档 - 第1部分结束*
