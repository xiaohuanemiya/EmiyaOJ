<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.emiyaoj.service.mapper.UserPermissionMapper">

    <!-- 根据用户ID查询直接权限ID列表 -->
    <select id="selectPermissionIdsByUserId" resultType="java.lang.Long">
        SELECT up.permission_id
        FROM user_permission up
        INNER JOIN permission p ON up.permission_id = p.id
        WHERE up.user_id = #{userId}
          AND p.status = 1
          AND p.deleted = 0
    </select>

    <!-- 根据用户ID删除用户权限关联 -->
    <delete id="deleteByUserId">
        DELETE FROM user_permission WHERE user_id = #{userId}
    </delete>

    <!-- 根据用户ID和权限ID查询用户权限 -->
    <select id="selectByUserIdAndPermissionId" resultType="com.emiyaoj.service.domain.pojo.UserPermission">
        SELECT * FROM user_permission
        WHERE user_id = #{userId} AND permission_id = #{permissionId}
    </select>

    <!-- 根据用户ID查询被拒绝的权限ID列表 -->
    <select id="selectDeniedPermissionIdsByUserId" resultType="java.lang.Long">
        SELECT up.permission_id
        FROM user_permission up
        INNER JOIN permission p ON up.permission_id = p.id
        WHERE up.user_id = #{userId}
          AND up.permission_type = 0
          AND p.status = 1
          AND p.deleted = 0
    </select>

    <!-- 根据用户ID查询被授予的权限ID列表 -->
    <select id="selectGrantedPermissionIdsByUserId" resultType="java.lang.Long">
        SELECT up.permission_id
        FROM user_permission up
        INNER JOIN permission p ON up.permission_id = p.id
        WHERE up.user_id = #{userId}
          AND up.permission_type = 1
          AND p.status = 1
          AND p.deleted = 0
    </select>

</mapper>
